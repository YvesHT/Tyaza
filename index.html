<!DOCTYPE html>
<html lang="rw" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <meta name="description" content="TYAZA - Umuvugizi w'Umutima | AI Virtual Therapy Assistant in Kinyarwanda by Kivura Labs">
    <meta name="theme-color" content="#0a0612">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>TYAZA Â· Umuvugizi w'Umutima</title>
    
    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&family=Crimson+Pro:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVFlBWkEiLCJzaG9ydF9uYW1lIjoidHlhemEiLCJzdGFydF91cmwiOiIuLyIsImRpc3BsYXkiLCJzdGFuZGFxvbmUiLCJtb2RlIjoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMGEwNjEyIiwidGhlbWVfY29sb3IiOiIjYTc4YmZhIiwiYWxpYXNlcyI6WyJ0eWF6YSJdLCJzY29wZSI6Ii8iLCJyb3V0ZXMiOlt7InBhdGgiOiIvIiwibW9kZSI6ImdldCJ9XSwiaWNvbnMiOlt7InNyYyI6Imh0dHBzOi8vY2RuLXN0YXRpYy5zaHVzaHVkaW8uY29tL2ljb25zL2FwcC0xMjgucG5nP3Y9MTYzOTY0NDY0NSIsInNpemVzIjoiMTI4eDEyOCJ9XSwic3RydWN0dXJlIjoic3RhbmRhbG9uZSJ9">
    
    <style>
        /* ================================================================
           TYAZA - PROFESSIONAL GRADE CSS FRAMEWORK
           Built with love by Kivura Labs
           ================================================================ */

        /* ----------------------------------------------------------------
           CSS CUSTOM PROPERTIES - DESIGN TOKENS
           ---------------------------------------------------------------- */
        :root {
            /* Color Tokens - Dark Theme (Default) */
            --color-primary-50: #f5f3ff;
            --color-primary-100: #ede9fe;
            --color-primary-200: #ddd6fe;
            --color-primary-300: #c4b5fd;
            --color-primary-400: #a78bfa;
            --color-primary-500: #8b5cf6;
            --color-primary-600: #7c3aed;
            --color-primary-700: #6d28d9;
            --color-primary-800: #5b21b6;
            --color-primary-900: #4c1d95;
            
            --color-secondary-50: #fdf2f8;
            --color-secondary-100: #fce7f3;
            --color-secondary-200: #fbcfe8;
            --color-secondary-300: #f9a8d4;
            --color-secondary-400: #f472b6;
            --color-secondary-500: #ec4899;
            --color-secondary-600: #db2777;
            --color-secondary-700: #be185d;
            --color-secondary-800: #9d174d;
            --color-secondary-900: #831843;
            
            --color-accent-50: #ecfdf5;
            --color-accent-100: #d1fae5;
            --color-accent-200: #a7f3d0;
            --color-accent-300: #6ee7b7;
            --color-accent-400: #34d399;
            --color-accent-500: #10b981;
            --color-accent-600: #059669;
            --color-accent-700: #047857;
            --color-accent-800: #065f46;
            --color-accent-900: #064e3b;
            
            --color-surface-950: #030014;
            --color-surface-900: #0a0612;
            --color-surface-800: #130d24;
            --color-surface-700: #1a1433;
            --color-surface-600: #231b42;
            --color-surface-500: #2d2352;
            --color-surface-400: #3d2f6d;
            --color-surface-300: #504185;
            --color-surface-200: #6b5a9e;
            --color-surface-100: #8b7ab8;
            --color-surface-50: #b8b0d0;
            
            --color-text-primary: #f8fafc;
            --color-text-secondary: #e2e8f0;
            --color-text-tertiary: #94a3b8;
            --color-text-muted: #64748b;
            --color-text-inverted: #0f172a;
            
            --color-success: #22c55e;
            --color-warning: #f59e0b;
            --color-error: #ef4444;
            --color-info: #3b82f6;
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, var(--color-primary-400), var(--color-secondary-400));
            --gradient-secondary: linear-gradient(135deg, var(--color-secondary-400), var(--color-accent-400));
            --gradient-cosmic: linear-gradient(135deg, var(--color-surface-900), var(--color-surface-800), var(--color-primary-900));
            --gradient-glow: radial-gradient(circle at center, var(--color-primary-500) 0%, transparent 70%);
            
            /* Shadows */
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);
            --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.6);
            --shadow-glow-primary: 0 0 40px rgba(139, 92, 246, 0.3);
            --shadow-glow-secondary: 0 0 40px rgba(236, 72, 153, 0.3);
            --shadow-glow-accent: 0 0 40px rgba(110, 231, 183, 0.3);
            
            /* Border Radius */
            --radius-none: 0;
            --radius-xs: 4px;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-2xl: 32px;
            --radius-full: 9999px;
            
            /* Spacing */
            --space-0: 0;
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 20px;
            --space-6: 24px;
            --space-8: 32px;
            --space-10: 40px;
            --space-12: 48px;
            --space-16: 64px;
            
            /* Typography */
            --font-sans: 'Outfit', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-display: 'Space Grotesk', var(--font-sans);
            --font-serif: 'Crimson Pro', Georgia, serif;
            
            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;
            --text-3xl: 1.875rem;
            --text-4xl: 2.25rem;
            --text-5xl: 3rem;
            
            --leading-tight: 1.25;
            --leading-normal: 1.5;
            --leading-relaxed: 1.75;
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: 500ms cubic-bezier(0.34, 1.56, 0.64, 1);
            --transition-spring: 600ms cubic-bezier(0.175, 0.885, 0.32, 1.275);
            
            /* Z-Index Scale */
            --z-dropdown: 100;
            --z-sticky: 200;
            --z-fixed: 300;
            --z-modal-backdrop: 400;
            --z-modal: 500;
            --z-popover: 600;
            --z-tooltip: 700;
            --z-toast: 800;
            --z-loading: 900;
            
            /* Layout */
            --sidebar-width: 320px;
            --header-height: 64px;
            --input-height: 80px;
            --content-max-width: 900px;
        }

        /* Light Theme */
        [data-theme="light"] {
            --color-surface-950: #f8fafc;
            --color-surface-900: #f1f5f9;
            --color-surface-800: #e2e8f0;
            --color-surface-700: #cbd5e1;
            --color-surface-600: #94a3b8;
            --color-surface-500: #64748b;
            --color-surface-400: #475569;
            --color-surface-300: #334155;
            --color-surface-200: #1e293b;
            --color-surface-100: #0f172a;
            --color-surface-50: #020617;
            
            --color-text-primary: #0f172a;
            --color-text-secondary: #334155;
            --color-text-tertiary: #64748b;
            --color-text-muted: #94a3b8;
            --color-text-inverted: #f8fafc;
        }

        /* ----------------------------------------------------------------
           CSS RESET & BASE STYLES
           ---------------------------------------------------------------- */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-sans);
            background: var(--color-surface-950);
            color: var(--color-text-primary);
            line-height: var(--leading-normal);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* ----------------------------------------------------------------
           UTILITY CLASSES - Display
           ---------------------------------------------------------------- */
        .d-none { display: none !important; }
        .d-block { display: block !important; }
        .d-flex { display: flex !important; }
        .d-inline-flex { display: inline-flex !important; }
        .d-grid { display: grid !important; }
        
        /* ----------------------------------------------------------------
           UTILITY CLASSES - Flexbox
           ---------------------------------------------------------------- */
        .flex-row { flex-direction: row; }
        .flex-col { flex-direction: column; }
        .flex-wrap { flex-wrap: wrap; }
        .flex-nowrap { flex-wrap: nowrap; }
        .flex-1 { flex: 1 1 0%; }
        .flex-auto { flex: 1 1 auto; }
        .flex-none { flex: none; }
        
        .items-start { align-items: flex-start; }
        .items-center { align-items: center; }
        .items-end { align-items: flex-end; }
        .items-stretch { align-items: stretch; }
        
        .justify-start { justify-content: flex-start; }
        .justify-center { justify-content: center; }
        .justify-end { justify-content: flex-end; }
        .justify-between { justify-content: space-between; }
        .justify-around { justify-content: space-around; }
        
        .gap-1 { gap: var(--space-1); }
        .gap-2 { gap: var(--space-2); }
        .gap-3 { gap: var(--space-3); }
        .gap-4 { gap: var(--space-4); }
        .gap-5 { gap: var(--space-5); }
        .gap-6 { gap: var(--space-6); }
        .gap-8 { gap: var(--space-8); }

        /* ----------------------------------------------------------------
           UTILITY CLASSES - Spacing
           ---------------------------------------------------------------- */
        .m-0 { margin: 0; }
        .m-auto { margin: auto; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        
        .p-0 { padding: 0; }
        .p-1 { padding: var(--space-1); }
        .p-2 { padding: var(--space-2); }
        .p-3 { padding: var(--space-3); }
        .p-4 { padding: var(--space-4); }
        .p-5 { padding: var(--space-5); }
        .p-6 { padding: var(--space-6); }
        
        .px-2 { padding-left: var(--space-2); padding-right: var(--space-2); }
        .px-3 { padding-left: var(--space-3); padding-right: var(--space-3); }
        .px-4 { padding-left: var(--space-4); padding-right: var(--space-4); }
        .px-6 { padding-left: var(--space-6); padding-right: var(--space-6); }
        
        .py-1 { padding-top: var(--space-1); padding-bottom: var(--space-1); }
        .py-2 { padding-top: var(--space-2); padding-bottom: var(--space-2); }
        .py-3 { padding-top: var(--space-3); padding-bottom: var(--space-3); }
        .py-4 { padding-top: var(--space-4); padding-bottom: var(--space-4); }

        /* ----------------------------------------------------------------
           UTILITY CLASSES - Typography
           ---------------------------------------------------------------- */
        .text-xs { font-size: var(--text-xs); }
        .text-sm { font-size: var(--text-sm); }
        .text-base { font-size: var(--text-base); }
        .text-lg { font-size: var(--text-lg); }
        .text-xl { font-size: var(--text-xl); }
        .text-2xl { font-size: var(--text-2xl); }
        .text-3xl { font-size: var(--text-3xl); }
        
        .font-normal { font-weight: 400; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        
        .text-primary { color: var(--color-text-primary); }
        .text-secondary { color: var(--color-text-secondary); }
        .text-tertiary { color: var(--color-text-tertiary); }
        .text-muted { color: var(--color-text-muted); }
        
        .leading-tight { line-height: var(--leading-tight); }
        .leading-normal { line-height: var(--leading-normal); }
        .leading-relaxed { line-height: var(--leading-relaxed); }

        /* ----------------------------------------------------------------
           UTILITY CLASSES - Sizing
           ---------------------------------------------------------------- */
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .min-h-screen { min-height: 100vh; }
        .h-screen { height: 100vh; }
        
        .max-w-md { max-width: 28rem; }
        .max-w-lg { max-width: 32rem; }
        .max-w-xl { max-width: 36rem; }
        .max-w-2xl { max-width: 42rem; }
        .max-w-3xl { max-width: 48rem; }
        .max-w-4xl { max-width: 56rem; }
        .max-w-full { max-width: 100%; }

        /* ----------------------------------------------------------------
           UTILITY CLASSES - Borders & Radius
           ---------------------------------------------------------------- */
        .rounded-none { border-radius: var(--radius-none); }
        .rounded-sm { border-radius: var(--radius-sm); }
        .rounded-md { border-radius: var(--radius-md); }
        .rounded-lg { border-radius: var(--radius-lg); }
        .rounded-xl { border-radius: var(--radius-xl); }
        .rounded-2xl { border-radius: var(--radius-2xl); }
        .rounded-full { border-radius: var(--radius-full); }
        
        .border { border: 1px solid var(--color-surface-600); }
        .border-0 { border: none; }
        .border-t { border-top: 1px solid var(--color-surface-600); }
        .border-b { border-bottom: 1px solid var(--color-surface-600); }

        /* ----------------------------------------------------------------
           UTILITY CLASSES - Effects
           ---------------------------------------------------------------- */
        .shadow-sm { box-shadow: var(--shadow-sm); }
        .shadow-md { box-shadow: var(--shadow-md); }
        .shadow-lg { box-shadow: var(--shadow-lg); }
        .shadow-xl { box-shadow: var(--shadow-xl); }
        .shadow-glow-primary { box-shadow: var(--shadow-glow-primary); }
        .shadow-glow-secondary { box-shadow: var(--shadow-glow-secondary); }
        
        .opacity-0 { opacity: 0; }
        .opacity-50 { opacity: 0.5; }
        .opacity-75 { opacity: 0.75; }
        .opacity-100 { opacity: 1; }
        
        .overflow-hidden { overflow: hidden; }
        .overflow-auto { overflow: auto; }
        .overflow-y-auto { overflow-y: auto; }
        .overflow-x-hidden { overflow-x: hidden; }
        
        .transition { transition: all var(--transition-base); }
        .transition-fast { transition: all var(--transition-fast); }
        .transition-slow { transition: all var(--transition-slow); }

        /* ----------------------------------------------------------------
           UTILITY CLASSES - Position
           ---------------------------------------------------------------- */
        .relative { position: relative; }
        .absolute { position: absolute; }
        .fixed { position: fixed; }
        .sticky { position: sticky; }
        
        .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
        .top-0 { top: 0; }
        .right-0 { right: 0; }
        .bottom-0 { bottom: 0; }
        .left-0 { left: 0; }
        
        .z-10 { z-index: 10; }
        .z-20 { z-index: 20; }
        .z-50 { z-index: 50; }
        .z-100 { z-index: 100; }

        /* ----------------------------------------------------------------
           COMPONENT: BUTTONS
           ---------------------------------------------------------------- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-5);
            font-family: inherit;
            font-size: var(--text-sm);
            font-weight: 500;
            line-height: 1;
            text-decoration: none;
            border: 1px solid transparent;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            user-select: none;
            white-space: nowrap;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-glow-primary);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg), var(--shadow-glow-primary);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--color-surface-700);
            border-color: var(--color-surface-500);
            color: var(--color-text-primary);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--color-surface-600);
            border-color: var(--color-primary-500);
        }

        .btn-ghost {
            background: transparent;
            color: var(--color-text-secondary);
        }

        .btn-ghost:hover:not(:disabled) {
            background: var(--color-surface-700);
            color: var(--color-text-primary);
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: var(--radius-md);
        }

        .btn-sm {
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-xs);
        }

        .btn-lg {
            padding: var(--space-4) var(--space-6);
            font-size: var(--text-base);
        }

        .btn-block {
            width: 100%;
        }

        /* ----------------------------------------------------------------
           COMPONENT: INPUTS
           ---------------------------------------------------------------- */
        .input {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            font-family: inherit;
            font-size: var(--text-base);
            color: var(--color-text-primary);
            background: var(--color-surface-800);
            border: 1px solid var(--color-surface-600);
            border-radius: var(--radius-lg);
            outline: none;
            transition: all var(--transition-fast);
        }

        .input::placeholder {
            color: var(--color-text-muted);
        }

        .input:focus {
            border-color: var(--color-primary-500);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }

        .input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        textarea.input {
            resize: vertical;
            min-height: 100px;
            max-height: 300px;
            line-height: var(--leading-relaxed);
        }

        /* ----------------------------------------------------------------
           COMPONENT: SELECT
           ---------------------------------------------------------------- */
        .select {
            appearance: none;
            width: 100%;
            padding: var(--space-3) var(--space-4);
            padding-right: var(--space-10);
            font-family: inherit;
            font-size: var(--text-sm);
            color: var(--color-text-primary);
            background: var(--color-surface-800);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right var(--space-3) center;
            border: 1px solid var(--color-surface-600);
            border-radius: var(--radius-lg);
            outline: none;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .select:focus {
            border-color: var(--color-primary-500);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }

        .select option {
            background: var(--color-surface-800);
            color: var(--color-text-primary);
        }

        /* ----------------------------------------------------------------
           COMPONENT: CHECKBOX & RADIO
           ---------------------------------------------------------------- */
        .checkbox, .radio {
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--color-surface-800);
            border: 2px solid var(--color-surface-500);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
        }

        .radio {
            border-radius: var(--radius-full);
        }

        .checkbox:checked, .radio:checked {
            background: var(--color-primary-500);
            border-color: var(--color-primary-500);
        }

        .checkbox:checked::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 6px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .radio:checked::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 8px;
            height: 8px;
            background: white;
            border-radius: var(--radius-full);
            transform: translate(-50%, -50%);
        }

        /* ----------------------------------------------------------------
           COMPONENT: SLIDER
           ---------------------------------------------------------------- */
        .slider {
            appearance: none;
            width: 100%;
            height: 6px;
            background: var(--color-surface-700);
            border-radius: var(--radius-full);
            outline: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: transform var(--transition-fast);
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--gradient-primary);
            border: none;
            border-radius: var(--radius-full);
            cursor: pointer;
            box-shadow: var(--shadow-md);
        }

        /* ----------------------------------------------------------------
           COMPONENT: BADGE
           ---------------------------------------------------------------- */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: var(--space-1) var(--space-2);
            font-size: var(--text-xs);
            font-weight: 500;
            border-radius: var(--radius-full);
            background: var(--color-surface-700);
            color: var(--color-text-secondary);
        }

        .badge-primary {
            background: rgba(139, 92, 246, 0.2);
            color: var(--color-primary-300);
        }

        .badge-secondary {
            background: rgba(236, 72, 153, 0.2);
            color: var(--color-secondary-300);
        }

        .badge-success {
            background: rgba(34, 197, 94, 0.2);
            color: var(--color-success);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--color-warning);
        }

        .badge-error {
            background: rgba(239, 68, 68, 0.2);
            color: var(--color-error);
        }

        /* ----------------------------------------------------------------
           COMPONENT: CARD
           ---------------------------------------------------------------- */
        .card {
            background: var(--color-surface-800);
            border: 1px solid var(--color-surface-600);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
        }

        .card-elevated {
            box-shadow: var(--shadow-lg);
        }

        .card-glass {
            background: rgba(26, 20, 51, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        /* ----------------------------------------------------------------
           COMPONENT: MODAL
           ---------------------------------------------------------------- */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: var(--z-modal-backdrop);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-base);
        }

        .modal-backdrop.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            background: var(--color-surface-800);
            border: 1px solid var(--color-surface-600);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-bounce);
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-6);
        }

        .modal-title {
            font-size: var(--text-xl);
            font-weight: 600;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--color-text-muted);
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }

        .modal-close:hover {
            background: var(--color-surface-700);
            color: var(--color-text-primary);
        }

        /* ----------------------------------------------------------------
           COMPONENT: TOAST NOTIFICATIONS
           ---------------------------------------------------------------- */
        .toast-container {
            position: fixed;
            bottom: var(--space-6);
            right: var(--space-6);
            z-index: var(--z-toast);
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .toast {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4) var(--space-5);
            background: var(--color-surface-700);
            border: 1px solid var(--color-surface-500);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            animation: toastSlideIn 0.3s ease-out;
            max-width: 350px;
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast-success { border-left: 4px solid var(--color-success); }
        .toast-error { border-left: 4px solid var(--color-error); }
        .toast-warning { border-left: 4px solid var(--color-warning); }
        .toast-info { border-left: 4px solid var(--color-info); }

        /* ----------------------------------------------------------------
           COMPONENT: DROPDOWN
           ---------------------------------------------------------------- */
        .dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            min-width: 180px;
            background: var(--color-surface-700);
            border: 1px solid var(--color-surface-500);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: var(--space-2);
            z-index: var(--z-dropdown);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all var(--transition-fast);
        }

        .dropdown.open .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(4px);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            color: var(--color-text-secondary);
            text-decoration: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .dropdown-item:hover {
            background: var(--color-surface-600);
            color: var(--color-text-primary);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--color-surface-500);
            margin: var(--space-2) 0;
        }

        /* ----------------------------------------------------------------
           COMPONENT: TABS
           ---------------------------------------------------------------- */
        .tabs {
            display: flex;
            gap: var(--space-1);
            background: var(--color-surface-800);
            padding: var(--space-1);
            border-radius: var(--radius-lg);
        }

        .tab {
            flex: 1;
            padding: var(--space-3) var(--space-4);
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--color-text-muted);
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .tab:hover {
            color: var(--color-text-secondary);
        }

        .tab.active {
            background: var(--color-surface-700);
            color: var(--color-text-primary);
        }

        /* ----------------------------------------------------------------
           COMPONENT: PROGRESS
           ---------------------------------------------------------------- */
        .progress {
            width: 100%;
            height: 8px;
            background: var(--color-surface-700);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            transition: width var(--transition-slow);
        }

        /* ----------------------------------------------------------------
           COMPONENT: SKELETON LOADING
           ---------------------------------------------------------------- */
        .skeleton {
            background: linear-gradient(
                90deg,
                var(--color-surface-700) 25%,
                var(--color-surface-600) 50%,
                var(--color-surface-700) 75%
            );
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
            border-radius: var(--radius-md);
        }

        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* ----------------------------------------------------------------
           COMPONENT: TOOLTIP
           ---------------------------------------------------------------- */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            padding: var(--space-2) var(--space-3);
            background: var(--color-surface-600);
            color: var(--color-text-primary);
            font-size: var(--text-xs);
            white-space: nowrap;
            border-radius: var(--radius-md);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-fast);
            pointer-events: none;
            z-index: var(--z-tooltip);
        }

        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-4px);
        }

        /* ----------------------------------------------------------------
           COMPONENT: SPINNER
           ---------------------------------------------------------------- */
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--color-surface-600);
            border-top-color: var(--color-primary-500);
            border-radius: var(--radius-full);
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .spinner-sm { width: 16px; height: 16px; border-width: 2px; }
        .spinner-lg { width: 40px; height: 40px; border-width: 4px; }

        /* ----------------------------------------------------------------
           COMPONENT: AVATAR
           ---------------------------------------------------------------- */
        .avatar {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-lg);
            font-weight: 600;
            color: white;
            background: var(--gradient-primary);
            overflow: hidden;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-sm { width: 32px; height: 32px; font-size: var(--text-xs); }
        .avatar-md { width: 40px; height: 40px; font-size: var(--text-sm); }
        .avatar-lg { width: 56px; height: 56px; font-size: var(--text-lg); }
        .avatar-xl { width: 80px; height: 80px; font-size: var(--text-2xl); }

        /* ----------------------------------------------------------------
           COMPONENT: LIST GROUP
           ---------------------------------------------------------------- */
        .list-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .list-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            color: var(--color-text-secondary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .list-item:hover {
            background: var(--color-surface-700);
            color: var(--color-text-primary);
        }

        .list-item.active {
            background: rgba(139, 92, 246, 0.15);
            color: var(--color-primary-300);
            border-left: 3px solid var(--color-primary-500);
        }

        /* ----------------------------------------------------------------
           COMPONENT: ALERT
           ---------------------------------------------------------------- */
        .alert {
            display: flex;
            gap: var(--space-3);
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            border-left: 4px solid;
        }

        .alert-info {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--color-info);
            color: var(--color-info);
        }

        .alert-success {
            background: rgba(34, 197, 94, 0.1);
            border-color: var(--color-success);
            color: var(--color-success);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--color-warning);
            color: var(--color-warning);
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--color-error);
            color: var(--color-error);
        }

        /* ================================================================
           TYAZA APPLICATION SPECIFIC STYLES
           ================================================================ */

        /* Cosmic Background */
        .app-background {
            position: fixed;
            inset: 0;
            z-index: 0;
            overflow: hidden;
            background: var(--color-surface-950);
        }

        .app-background::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(236, 72, 153, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 60% 10%, rgba(110, 231, 183, 0.05) 0%, transparent 40%),
                radial-gradient(ellipse at 40% 90%, rgba(139, 92, 246, 0.08) 0%, transparent 45%);
            animation: cosmicDrift 40s ease-in-out infinite;
        }

        .app-background::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            opacity: 0.025;
            pointer-events: none;
        }

        .stars-container {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: var(--radius-full);
            animation: starTwinkle 3s ease-in-out infinite;
        }

        .star.large {
            width: 3px;
            height: 3px;
        }

        .star.medium {
            width: 2px;
            height: 2px;
        }

        @keyframes cosmicDrift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(2%, 1%) rotate(0.5deg); }
            50% { transform: translate(-1%, 2%) rotate(-0.5deg); }
            75% { transform: translate(1%, -1%) rotate(0.3deg); }
        }

        @keyframes starTwinkle {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 0.9; transform: scale(1.3); }
        }

        /* ================================================================
           MAIN APPLICATION LAYOUT
           ================================================================ */
        .app-layout {
            display: flex;
            width: 100vw;
            height: 100vh;
            position: relative;
            z-index: 10;
        }

        /* ----------------------------------------------------------------
           SIDEBAR
           ---------------------------------------------------------------- */
        .app-sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background: rgba(10, 6, 18, 0.92);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border-right: 1px solid rgba(139, 92, 246, 0.15);
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: var(--z-fixed);
            transition: transform var(--transition-slow);
        }

        .sidebar-header {
            padding: var(--space-5);
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            font-size: 1.5rem;
            color: white;
            box-shadow: var(--shadow-glow-primary);
            overflow: hidden;
        }

        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }

        .logo-text {
            flex: 1;
        }

        .logo-title {
            font-family: var(--font-display);
            font-size: var(--text-xl);
            font-weight: 700;
            background: linear-gradient(135deg, var(--color-text-primary), var(--color-secondary-300));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .logo-subtitle {
            font-size: var(--text-xs);
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 2px;
        }

        /* Sidebar Sections */
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .sidebar-section {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .sidebar-section-title {
            font-size: var(--text-xs);
            font-weight: 600;
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 0 var(--space-2);
        }

        /* New Chat Button */
        .new-chat-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            width: 100%;
            padding: var(--space-4);
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(236, 72, 153, 0.1));
            border: 1px solid rgba(236, 72, 153, 0.3);
            border-radius: var(--radius-xl);
            color: var(--color-text-primary);
            font-family: inherit;
            font-size: var(--text-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .new-chat-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.25), rgba(236, 72, 153, 0.15));
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow-primary);
        }

        /* Settings Card */
        .settings-card {
            background: var(--color-surface-800);
            border: 1px solid rgba(139, 92, 246, 0.1);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
        }

        .settings-row {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .settings-label {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-xs);
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-weight: 500;
        }

        /* Voice Controls */
        .voice-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-3);
        }

        .voice-control-item {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .voice-control-label {
            display: flex;
            justify-content: space-between;
            font-size: var(--text-xs);
            color: var(--color-text-tertiary);
        }

        .voice-control-value {
            color: var(--color-primary-300);
            font-weight: 500;
        }

        /* History List */
        .history-list {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            min-height: 150px;
        }

        .history-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: var(--space-3);
            background: rgba(139, 92, 246, 0.05);
            border: 1px solid transparent;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            max-height: 60px;
            overflow: hidden;
        }

        .history-item:hover {
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.2);
        }

        .history-item.active {
            background: rgba(236, 72, 153, 0.1);
            border-color: rgba(236, 72, 153, 0.3);
            border-left: 3px solid var(--color-secondary-400);
        }

        .history-title {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--color-text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }

        .history-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: var(--text-xs);
            color: var(--color-text-muted);
        }

        .history-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-8);
            color: var(--color-text-muted);
            text-align: center;
            gap: var(--space-2);
        }

        .history-empty i {
            font-size: 2rem;
            opacity: 0.5;
        }

        /* Info Card */
        .info-card {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(236, 72, 153, 0.05));
            border: 1px solid rgba(139, 92, 246, 0.15);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            font-size: var(--text-xs);
            color: var(--color-text-tertiary);
            line-height: 1.7;
        }

        .info-card-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--color-secondary-300);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .info-card-logo {
            width: 24px;
            height: 24px;
            margin-right: var(--space-2);
        }

        .info-card-divider {
            height: 1px;
            background: rgba(139, 92, 246, 0.1);
            margin: var(--space-3) 0;
        }

        .info-highlight {
            color: var(--color-primary-300);
            font-weight: 500;
        }

        .info-card-footer {
            font-size: 0.65rem;
            color: var(--color-text-muted);
            text-align: center;
            margin-top: var(--space-3);
            padding-top: var(--space-3);
            border-top: 1px solid rgba(139, 92, 246, 0.1);
        }

        /* ----------------------------------------------------------------
           MAIN CHAT AREA
           ---------------------------------------------------------------- */
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            position: relative;
            overflow: hidden;
        }

        /* Chat Header */
        .chat-header {
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--space-6);
            background: rgba(10, 6, 18, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
            z-index: var(--z-sticky);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .menu-toggle {
            display: none;
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            color: white;
            font-weight: 600;
        }

        .chat-info h1 {
            font-size: var(--text-base);
            font-weight: 600;
            color: var(--color-text-primary);
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-xs);
            color: var(--color-accent-400);
        }

        .status-indicator {
            width: 6px;
            height: 6px;
            background: var(--color-accent-400);
            border-radius: var(--radius-full);
            animation: statusPulse 2s ease-in-out infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.3); }
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        /* Messages Container */
        .messages-wrapper {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: var(--space-6);
            display: flex;
            flex-direction: column;
            gap: var(--space-5);
        }

        .messages-wrapper::-webkit-scrollbar {
            width: 6px;
        }

        .messages-wrapper::-webkit-scrollbar-track {
            background: transparent;
        }

        .messages-wrapper::-webkit-scrollbar-thumb {
            background: var(--color-surface-500);
            border-radius: var(--radius-full);
        }

        .messages-wrapper::-webkit-scrollbar-thumb:hover {
            background: var(--color-surface-400);
        }

        /* Welcome Screen */
        .welcome-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-8);
            text-align: center;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .welcome-icon {
            width: 140px;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--color-primary-400), var(--color-secondary-400), var(--color-accent-400));
            border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
            font-size: 4rem;
            color: white;
            margin-bottom: var(--space-8);
            box-shadow: var(--shadow-glow-primary), var(--shadow-glow-secondary);
            animation: morphShape 10s ease-in-out infinite, iconFloat 6s ease-in-out infinite;
        }

        @keyframes morphShape {
            0%, 100% { border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; }
            33% { border-radius: 70% 30% 50% 50% / 30% 60% 40% 70%; }
            66% { border-radius: 30% 70% 40% 60% / 60% 30% 70% 40%; }
        }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-12px) rotate(2deg); }
        }

        .welcome-title {
            font-family: var(--font-display);
            font-size: var(--text-5xl);
            font-weight: 800;
            background: linear-gradient(135deg, var(--color-text-primary), var(--color-primary-300), var(--color-secondary-300));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-2);
            letter-spacing: -0.03em;
        }

        .welcome-subtitle {
            font-family: var(--font-serif);
            font-size: var(--text-xl);
            font-style: italic;
            color: var(--color-text-tertiary);
            margin-bottom: var(--space-6);
        }

        .welcome-quote {
            font-family: var(--font-serif);
            font-size: var(--text-lg);
            color: var(--color-text-tertiary);
            max-width: 500px;
            line-height: 1.9;
            padding: var(--space-5) var(--space-8);
            background: rgba(26, 20, 51, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.15);
            border-radius: var(--radius-xl);
            margin-bottom: var(--space-8);
        }

        .welcome-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-3);
            justify-content: center;
            max-width: 600px;
        }

        .suggestion-btn {
            padding: var(--space-3) var(--space-5);
            background: var(--color-surface-800);
            border: 1px solid var(--color-surface-600);
            border-radius: var(--radius-full);
            color: var(--color-text-secondary);
            font-family: inherit;
            font-size: var(--text-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .suggestion-btn:hover {
            background: rgba(139, 92, 246, 0.15);
            border-color: var(--color-primary-500);
            color: var(--color-text-primary);
            transform: translateY(-2px);
        }

        /* Message Styles */
        .message {
            display: flex;
            gap: var(--space-4);
            max-width: 85%;
            animation: messageSlideIn 0.4s ease-out;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: var(--text-base);
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: var(--color-surface-700);
            border: 1px solid var(--color-surface-500);
            color: var(--color-text-muted);
        }

        .message.assistant .message-avatar {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-glow-primary);
        }

        .message-content {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .message.user .message-content {
            align-items: flex-end;
        }

        .message-bubble {
            padding: var(--space-4) var(--space-5);
            line-height: 1.75;
            font-size: var(--text-base);
            word-wrap: break-word;
        }

        .message.user .message-bubble {
            background: var(--color-surface-700);
            border: 1px solid var(--color-surface-500);
            border-radius: var(--radius-xl) var(--radius-xl) var(--radius-sm) var(--radius-xl);
            color: var(--color-text-primary);
        }

        .message.assistant .message-bubble {
            background: rgba(26, 20, 51, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.15);
            border-radius: var(--radius-xl) var(--radius-xl) var(--radius-xl) var(--radius-sm);
            color: var(--color-text-secondary);
        }

        .message-meta {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: 0 var(--space-2);
        }

        .message-time {
            font-size: var(--text-xs);
            color: var(--color-text-muted);
        }

        .message-actions {
            display: flex;
            gap: var(--space-1);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--color-surface-700);
            border: 1px solid var(--color-surface-500);
            border-radius: var(--radius-md);
            color: var(--color-text-muted);
            font-size: var(--text-xs);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .message-action:hover {
            background: var(--color-surface-600);
            color: var(--color-text-primary);
            transform: scale(1.1);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .typing-avatar {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            color: white;
            font-weight: 600;
        }

        .typing-bubble {
            display: flex;
            gap: 6px;
            padding: var(--space-4) var(--space-5);
            background: rgba(26, 20, 51, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.15);
            border-radius: var(--radius-xl);
        }

        .typing-dot {
            width: 10px;
            height: 10px;
            border-radius: var(--radius-full);
            animation: typingBounce 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(1) { background: var(--color-primary-400); }
        .typing-dot:nth-child(2) { background: var(--color-secondary-400); animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { background: var(--color-accent-400); animation-delay: 0.4s; }

        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
            30% { transform: translateY(-10px); opacity: 1; }
        }

        /* ----------------------------------------------------------------
           INPUT AREA
           ---------------------------------------------------------------- */
        .input-area {
            padding: var(--space-5) var(--space-6) var(--space-6);
            background: linear-gradient(to top, var(--color-surface-950) 50%, transparent);
            position: relative;
        }

        .input-container {
            max-width: var(--content-max-width);
            margin: 0 auto;
            background: rgba(26, 20, 51, 0.9);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: var(--radius-2xl);
            padding: var(--space-2) var(--space-2) var(--space-2) var(--space-5);
            display: flex;
            align-items: flex-end;
            gap: var(--space-3);
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-fast);
        }

        .input-container:focus-within {
            border-color: var(--color-primary-500);
            box-shadow: var(--shadow-lg), 0 0 0 3px rgba(139, 92, 246, 0.15);
        }

        .input-textarea {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--color-text-primary);
            font-family: inherit;
            font-size: var(--text-base);
            padding: var(--space-4) 0;
            resize: none;
            max-height: 150px;
            min-height: 24px;
            line-height: 1.6;
        }

        .input-textarea::placeholder {
            color: var(--color-text-muted);
        }

        .input-actions {
            display: flex;
            gap: var(--space-2);
            padding-bottom: var(--space-2);
        }

        .input-btn {
            width: 52px;
            height: 52px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            border: none;
            font-size: 1.1rem;
        }

        .voice-btn {
            background: rgba(139, 92, 246, 0.15);
            border: 1px solid rgba(236, 72, 153, 0.3);
            color: var(--color-secondary-400);
        }

        .voice-btn:hover {
            background: rgba(139, 92, 246, 0.25);
            transform: scale(1.05);
        }

        .voice-btn.listening {
            background: var(--color-secondary-500);
            color: white;
            animation: micPulse 1.5s infinite;
            border-color: var(--color-secondary-500);
        }

        @keyframes micPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(236, 72, 153, 0.5); }
            50% { box-shadow: 0 0 0 20px rgba(236, 72, 153, 0); }
        }

        .send-btn {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-glow-primary);
        }

        .send-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg), var(--shadow-glow-primary);
        }

        .send-btn:active:not(:disabled) {
            transform: scale(0.95);
        }

        .send-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .voice-status {
            text-align: center;
            font-size: var(--text-sm);
            color: var(--color-text-tertiary);
            min-height: 24px;
            margin-top: var(--space-3);
            transition: color var(--transition-fast);
        }

        .voice-status.active {
            color: var(--color-secondary-400);
        }

        /* ----------------------------------------------------------------
           SCROLL TO BOTTOM BUTTON
           ---------------------------------------------------------------- */
        .scroll-bottom {
            position: absolute;
            bottom: 100px;
            right: var(--space-6);
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-4);
            background: rgba(26, 20, 51, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(236, 72, 153, 0.3);
            border-radius: var(--radius-full);
            color: var(--color-text-secondary);
            font-size: var(--text-sm);
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all var(--transition-smooth);
            z-index: 40;
            box-shadow: var(--shadow-glow-secondary);
        }

        .scroll-bottom.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .scroll-bottom:hover {
            background: rgba(236, 72, 153, 0.2);
            color: var(--color-text-primary);
        }

        /* ----------------------------------------------------------------
           STT OVERLAY
           ---------------------------------------------------------------- */
        .stt-overlay {
            position: fixed;
            inset: 0;
            background: rgba(3, 0, 20, 0.9);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-smooth);
        }

        .stt-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .stt-modal {
            background: rgba(26, 20, 51, 0.98);
            border: 2px solid var(--color-secondary-500);
            border-radius: var(--radius-2xl);
            padding: var(--space-10);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-6);
            box-shadow: var(--shadow-glow-secondary), var(--shadow-xl);
            transform: scale(0.9);
            transition: transform var(--transition-bounce);
            max-width: 90vw;
        }

        .stt-overlay.active .stt-modal {
            transform: scale(1);
        }

        .stt-visualizer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            height: 80px;
        }

        .stt-bar {
            width: 8px;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            animation: sttWave 0.7s ease-in-out infinite alternate;
        }

        .stt-bar:nth-child(1) { height: 25px; animation-delay: 0s; }
        .stt-bar:nth-child(2) { height: 40px; animation-delay: 0.1s; }
        .stt-bar:nth-child(3) { height: 60px; animation-delay: 0.2s; }
        .stt-bar:nth-child(4) { height: 45px; animation-delay: 0.3s; }
        .stt-bar:nth-child(5) { height: 70px; animation-delay: 0.4s; }
        .stt-bar:nth-child(6) { height: 35px; animation-delay: 0.5s; }
        .stt-bar:nth-child(7) { height: 50px; animation-delay: 0.6s; }
        .stt-bar:nth-child(8) { height: 30px; animation-delay: 0.7s; }

        @keyframes sttWave {
            from { height: 15px; transform: scaleY(1); }
            to { height: 70px; transform: scaleY(1); }
        }

        .stt-text {
            font-size: var(--text-xl);
            color: var(--color-text-secondary);
            text-align: center;
            max-width: 400px;
            min-height: 30px;
        }

        .stt-hint {
            font-size: var(--text-sm);
            color: var(--color-text-muted);
        }

        /* ----------------------------------------------------------------
           LOADING SCREEN
           ---------------------------------------------------------------- */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: var(--color-surface-950);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: var(--space-6);
            z-index: var(--z-loading);
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-logo {
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-primary);
            border-radius: var(--radius-xl);
            font-size: 3rem;
            color: white;
            animation: logoFloat 3s ease-in-out infinite;
            box-shadow: var(--shadow-glow-primary);
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--color-surface-600);
            border-top-color: var(--color-primary-500);
            border-radius: var(--radius-full);
            animation: spin 0.8s linear infinite;
        }

        .loading-text {
            font-size: var(--text-base);
            color: var(--color-text-tertiary);
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: var(--color-surface-700);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            animation: loadingProgress 2s ease-in-out infinite;
        }

        @keyframes loadingProgress {
            0% { width: 0%; margin-left: 0; }
            50% { width: 60%; margin-left: 20%; }
            100% { width: 0%; margin-left: 100%; }
        }

        /* ----------------------------------------------------------------
           SIDEBAR OVERLAY (MOBILE)
           ---------------------------------------------------------------- */
        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: calc(var(--z-fixed) - 1);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-smooth);
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* ----------------------------------------------------------------
           RESPONSIVE STYLES
           ---------------------------------------------------------------- */
        @media (max-width: 1024px) {
            :root {
                --sidebar-width: 280px;
            }
        }

        @media (max-width: 768px) {
            :root {
                --sidebar-width: 85vw;
                --header-height: 56px;
            }

            .app-sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                transform: translateX(-100%);
                box-shadow: var(--shadow-xl);
            }

            .app-sidebar.open {
                transform: translateX(0);
            }

            .sidebar-overlay {
                display: block;
            }

            .menu-toggle {
                display: flex !important;
            }

            .welcome-title {
                font-size: var(--text-4xl);
            }

            .welcome-subtitle {
                font-size: var(--text-lg);
            }

            .welcome-icon {
                width: 100px;
                height: 100px;
                font-size: 3rem;
            }

            .message {
                max-width: 92%;
            }

            .messages-wrapper {
                padding: var(--space-4);
            }

            .input-area {
                padding: var(--space-4);
            }

            .input-container {
                border-radius: var(--radius-xl);
                padding: var(--space-1) var(--space-1) var(--space-1) var(--space-4);
            }

            .input-btn {
                width: 48px;
                height: 48px;
            }

            .scroll-bottom {
                right: var(--space-4);
                bottom: 90px;
            }

            .chat-header {
                padding: 0 var(--space-4);
            }

            .welcome-screen {
                padding: var(--space-6);
            }

            .info-card {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .welcome-suggestions {
                flex-direction: column;
                align-items: center;
            }

            .suggestion-btn {
                width: 100%;
                max-width: 280px;
            }
        }

        /* ----------------------------------------------------------------
           ANIMATION UTILITIES
           ---------------------------------------------------------------- */
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        .animate-slide-down { animation: slideDown 0.3s ease-out; }
        .animate-scale-in { animation: scaleIn 0.2s ease-out; }
        .animate-bounce { animation: bounce 1s infinite; }
        .animate-pulse { animation: pulse 2s infinite; }
        .animate-spin { animation: spin 1s linear infinite; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* Focus States */
        :focus-visible {
            outline: 2px solid var(--color-primary-500);
            outline-offset: 2px;
        }

        /* Selection */
        ::selection {
            background: var(--color-primary-500);
            color: white;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--color-surface-500);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-surface-400);
        }

        /* Print Styles */
        @media print {
            .app-background,
            .sidebar,
            .chat-header,
            .input-area,
            .scroll-bottom,
            .stt-overlay,
            .loading-screen {
                display: none !important;
            }

            .chat-main {
                width: 100%;
                height: auto;
                overflow: visible;
            }

            .messages-wrapper {
                overflow: visible;
                padding: 0;
            }

            .message {
                max-width: 100%;
                margin-bottom: 20px;
            }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Application Root -->
    <div id="app">
        <!-- Cosmic Background -->
        <div class="app-background">
            <div class="stars-container" id="starsContainer"></div>
        </div>

        <!-- Sidebar Overlay (Mobile) -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Main Layout -->
        <div class="app-layout">
            <!-- Sidebar -->
            <aside class="app-sidebar" id="sidebar">
                <!-- Header -->
                <div class="sidebar-header">
                    <div class="logo-container">
                        <div class="logo-icon">
                            <img src="https://raw.githubusercontent.com/kivuralabs/tyaza/main/tyaza-logo.png" alt="TYAZA" style="width:100%;height:100%;object-fit:contain;" onerror="this.innerHTML='ðï¸'">
                        </div>
                        <div class="logo-text">
                            <div class="logo-title">TYAZA</div>
                            <div class="logo-subtitle">Umuvugizi w'Umutima</div>
                        </div>
                    </div>
                </div>

                <!-- Content -->
                <div class="sidebar-content">
                    <!-- New Chat Button -->
                    <button class="new-chat-btn" id="newChatBtn">
                        <span>â¨</span> Igikoni Gishya
                    </button>

                    <!-- AI Model Selection -->
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Ubugeni bw'Ikoranabuhanga</div>
                        <div class="settings-card">
                            <select class="select" id="modelSelect">
                                <option value="gpt-4o-mini">GPT-4o Mini Â· Byoroshye</option>
                                <option value="claude-3-haiku">Claude 3 Haiku Â· Bishya</option>
                                <option value="gemini-1.5-flash">Gemini 1.5 Flash Â· Flax</option>
                                <option value="gpt-4o">GPT-4o Â· Byisonga</option>
                            </select>
                        </div>
                    </div>

                    <!-- Voice Settings -->
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Amajwi & Mikorofoni</div>
                        <div class="settings-card">
                            <div class="settings-row" style="margin-bottom: var(--space-4);">
                                <button class="btn btn-secondary btn-block" id="micTestBtn">
                                    <span>ð¤</span> Genzura Mikorofoni
                                </button>
                            </div>
                            <div class="settings-row" style="margin-bottom: var(--space-4);">
                                <label class="settings-label">Ijwi</label>
                                <select class="select" id="voiceSelect">
                                    <option value="Google UK English Female">ijwi ry'umugore (UK)</option>
                                    <option value="Google UK English Male">ijwi ry'umugabo (UK)</option>
                                    <option value="Samantha">Samantha Â· ryorohe</option>
                                    <option value="Microsoft Zira">Microsoft Zira</option>
                                    <option value="Google US English">US English</option>
                                </select>
                            </div>
                            <div class="voice-controls">
                                <div class="voice-control-item">
                                    <div class="voice-control-label">
                                        <span>Umurenge</span>
                                        <span class="voice-control-value" id="rateValue">0.9</span>
                                    </div>
                                    <input type="range" class="slider" id="rateSlider" min="0.5" max="1.5" step="0.05" value="0.9">
                                </div>
                                <div class="voice-control-item">
                                    <div class="voice-control-label">
                                        <span>Ibarura</span>
                                        <span class="voice-control-value" id="pitchValue">1.0</span>
                                    </div>
                                    <input type="range" class="slider" id="pitchSlider" min="0.5" max="2" step="0.05" value="1.0">
                                </div>
                            </div>
                            <div class="settings-row" style="margin-top: var(--space-4);">
                                <button class="btn btn-secondary btn-block" id="previewBtn">
                                    <span>ð</span> Subira ijwi
                                </button>
                            </div>
                            <div class="settings-row" style="margin-top: var(--space-3);">
                                <label class="checkbox-label">
                                    <input type="checkbox" class="checkbox" id="autoTTS" checked>
                                    Soma igisubizo mu ijwi
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Theme Settings -->
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Imyifatire</div>
                        <div class="settings-card">
                            <div class="settings-row">
                                <label class="checkbox-label">
                                    <input type="checkbox" class="checkbox" id="soundEffects" checked>
                                    Imivugo y'umuziki
                                </label>
                            </div>
                            <div class="settings-row" style="margin-top: var(--space-3);">
                                <label class="checkbox-label">
                                    <input type="checkbox" class="checkbox" id="animations" checked>
                                    Ibinyuzwamo
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Chat History -->
                    <div class="sidebar-section" style="flex: 1; min-height: 0;">
                        <div class="sidebar-section-title" style="display: flex; justify-content: space-between; align-items: center;">
                            <span>ð Amateka</span>
                            <button class="btn btn-ghost btn-sm" id="clearHistory">Hanagura</button>
                        </div>
                        <div class="history-list" id="historyList">
                            <div class="history-empty">
                                <i>ð­</i>
                                <span>Nta mateka</span>
                            </div>
                        </div>
                    </div>

                    <!-- Info Card -->
                    <div class="info-card">
                        <div class="info-card-title">
                            <img src="https://raw.githubusercontent.com/kivuralabs/tyaza/main/kivura-logo.png" alt="Kivura Labs" class="info-card-logo" onerror="this.style.display='none'">
                            ð¢ KIVURA LABS
                        </div>
                        <div>
                            <span class="info-highlight">Intego:</span> AI ifasha mu 
                            by'umutekano mu mutwe
                        </div>
                        <div class="info-card-divider"></div>
                        <div class="info-card-title" style="font-size: var(--text-xs);">
                            ð¤ TYAZA
                        </div>
                        <div>Umuvugizi w'Umutima â AI therapy mu Kinyarwanda</div>
                        <div class="info-card-footer">
                            Â© 2025 Kivura Labs Â· Rwanda
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Chat Area -->
            <main class="chat-main">
                <!-- Header -->
                <header class="chat-header">
                    <div class="header-left">
                        <button class="btn btn-icon btn-ghost menu-toggle" id="menuToggle">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div class="chat-title">
                            <div class="chat-avatar">
                                <img src="https://raw.githubusercontent.com/kivuralabs/tyaza/main/tyaza-logo.png" alt="TYAZA" style="width:100%;height:100%;object-fit:contain;" onerror="this.parentElement.innerHTML='T'">
                            </div>
                            <div class="chat-info">
                                <h1>TYAZA</h1>
                                <div class="chat-status">
                                    <span class="status-indicator"></span>
                                    <span>Irereye</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-icon btn-ghost tooltip" data-tooltip="Fata ingendo" id="exportChat">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="btn btn-icon btn-ghost tooltip" data-tooltip="Hanagura chat" id="clearChat">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                        <button class="btn btn-icon btn-ghost tooltip" data-tooltip="Ibiro" id="settingsBtn">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </header>

                <!-- Messages -->
                <div class="messages-wrapper" id="messagesWrapper">
                    <!-- Welcome Screen -->
                    <div class="welcome-screen" id="welcomeScreen">
                        <div class="welcome-icon">
                            <img src="https://raw.githubusercontent.com/kivuralabs/tyaza/main/tyaza-logo.png" alt="TYAZA" style="width:100%;height:100%;object-fit:contain;border-radius:inherit;" onerror="this.parentElement.innerHTML='T'">
                        </div>
                        <h1 class="welcome-title">TYAZA</h1>
                        <p class="welcome-subtitle">igisubizo cy'umutima</p>
                        <div class="welcome-quote">
                            "Ndi hano. Buri mwanya, buri jambo â<br>
                            byakiriwe mu mahoro n'igondero."
                        </div>
                        <div class="welcome-suggestions">
                            <button class="suggestion-btn" data-prompt="ndashaka kuvuga">ð¬ Ndashaka kuvuga</button>
                            <button class="suggestion-btn" data-prompt="mfite ibibazo">ð Mfite ibibazo</button>
                            <button class="suggestion-btn" data-prompt="ngomba inkunga">ð¤ Ngomba inkunga</button>
                            <button class="suggestion-btn" data-prompt="narushijeho">ð Narushijeho</button>
                        </div>
                    </div>
                </div>

                <!-- Scroll to Bottom -->
                <button class="scroll-bottom" id="scrollBottom">
                    <i class="fas fa-arrow-down"></i>
                    subira hasi
                </button>

                <!-- Input Area -->
                <div class="input-area">
                    <div class="input-container">
                        <textarea 
                            class="input-textarea" 
                            id="messageInput" 
                            placeholder="sangiza icyo utekereza..." 
                            rows="1"
                        ></textarea>
                        <div class="input-actions">
                            <button class="input-btn voice-btn tooltip" data-toholeho:Soma inyuguti" id="voiceInputBtn">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button class="input-btn send-btn tooltip" data-toholeho:Tuma ubutumwa" id="sendBtn" disabled>
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                    <div class="voice-status" id="voiceStatus"></div>
                </div>
            </main>
        </div>

        <!-- STT Overlay -->
        <div class="stt-overlay" id="sttOverlay">
            <div class="stt-modal">
                <div class="stt-visualizer">
                    <span class="stt-bar"></span>
                    <span class="stt-bar"></span>
                    <span class="stt-bar"></span>
                    <span class="stt-bar"></span>
                    <span class="stt-bar"></span>
                    <span class="stt-bar"></span>
                    <span class="stt-bar"></span>
                    <span class="stt-bar"></span>
                </div>
                <div class="stt-text" id="sttText">ndakumva...</div>
                <div class="stt-hint">soma ugire icyo uhambaro</div>
            </div>
        </div>

        <!-- Loading Screen -->
        <div class="loading-screen" id="loadingScreen">
            <div class="loading-logo">ðï¸</div>
            <div class="spinner"></div>
            <div class="loading-text">Ihuza kuri Tyaza...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>

        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer"></div>
    </div>

    <!-- Puter AI SDK -->
    <script>
        window.puter = null;
        window.puterError = null;
    </script>
    <script src="https://js.puter.com/v2/"></script>

    <!-- TYAZA Application Script -->
    <script>
        /* ================================================================
           TYAZA - PROFESSIONAL GRADE APPLICATION
           Built with love by Kivura Labs
           ================================================================ */

        (function() {
            'use strict';

            // ============================================================
            // UTILITY FUNCTIONS
            // ============================================================

            /**
             * Generate unique ID
             */
            function generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            /**
             * Escape HTML entities
             */
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            /**
             * Format date for display
             */
            function formatRelativeTime(timestamp) {
                const now = Date.now();
                const diff = now - timestamp;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);

                if (minutes < 1) return 'none';
                if (minutes < 60) return `${minutes} min.`;
                if (hours < 24) return `${hours} hr.`;
                if (days < 7) return `${days} j.`;
                
                return new Date(timestamp).toLocaleDateString('rw-RW', {
                    day: 'numeric',
                    month: 'short'
                });
            }

            /**
             * Format message content
             */
            function formatMessageContent(text) {
                if (!text) return '';
                
                let formatted = escapeHtml(text);
                
                // Highlight emotional keywords
                const keywords = [
                    'umva', 'umutima', 'mahoro', 'impuhwe', 'mbabarwe', 
                    'wigitsa', 'ubwoba', 'agahinda', 'ibyishimo', 'ishinga',
                    'komeza', 'nkunda', 'jye', 'maze', 'byose', 'buri'
                ];
                
                keywords.forEach(word => {
                    const regex = new RegExp(`\\b(${word})\\b`, 'gi');
                    formatted = formatted.replace(regex, '<span style="color:var(--color-secondary-400);font-weight:500;">$1</span>');
                });
                
                // Line breaks
                formatted = formatted.replace(/\n/g, '<br>');
                
                return formatted;
            }

            /**
             * Format time for messages
             */
            function formatMessageTime() {
                return new Date().toLocaleTimeString('rw-RW', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            // ============================================================
            // STATE MANAGEMENT
            // ============================================================

            const StateManager = {
                state: {
                    // Chat state
                    currentChat: [],
                    currentChatId: generateId(),
                    chatStarted: false,
                    
                    // UI state
                    isSidebarOpen: false,
                    isGenerating: false,
                    isListening: false,
                    puterReady: false,
                    
                    // Voice state
                    micPermission: false,
                    speechRecognition: null,
                    speechSynthesis: window.speechSynthesis,
                    availableVoices: [],
                    
                    // Settings
                    settings: {
                        model: 'gpt-4o-mini',
                        voice: 'Google UK English Female',
                        rate: 0.9,
                        pitch: 1.0,
                        autoTTS: true,
                        soundEffects: true,
                        animations: true
                    }
                },

                /**
                 * Get state value
                 */
                get(path) {
                    return path.split('.').reduce((obj, key) => obj?.[key], this.state);
                },

                /**
                 * Set state value
                 */
                set(path, value) {
                    const keys = path.split('.');
                    const lastKey = keys.pop();
                    const obj = keys.reduce((o, key) => {
                        if (!o[key]) o[key] = {};
                        return o[key];
                    }, this.state);
                    obj[lastKey] = value;
                },

                /**
                 * Update multiple state values
                 */
                update(updates) {
                    Object.keys(updates).forEach(key => {
                        this.set(key, updates[key]);
                    });
                },

                /**
                 * Load settings from localStorage
                 */
                loadSettings() {
                    try {
                        const saved = localStorage.getItem('tyaza_settings');
                        if (saved) {
                            const parsed = JSON.parse(saved);
                            this.state.settings = { ...this.state.settings, ...parsed };
                        }
                    } catch (e) {
                        console.warn('Failed to load settings:', e);
                    }
                },

                /**
                 * Save settings to localStorage
                 */
                saveSettings() {
                    try {
                        localStorage.setItem('tyaza_settings', JSON.stringify(this.state.settings));
                    } catch (e) {
                        console.warn('Failed to save settings:', e);
                    }
                }
            };

            // ============================================================
            // EVENT BUS
            // ============================================================

            const EventBus = {
                events: {},

                /**
                 * Subscribe to event
                 */
                on(event, callback) {
                    if (!this.events[event]) {
                        this.events[event] = [];
                    }
                    this.events[event].push(callback);
                    return () => this.off(event, callback);
                },

                /**
                 * Unsubscribe from event
                 */
                off(event, callback) {
                    if (!this.events[event]) return;
                    this.events[event] = this.events[event].filter(cb => cb !== callback);
                },

                /**
                 * Emit event
                 */
                emit(event, data) {
                    if (!this.events[event]) return;
                    this.events[event].forEach(callback => {
                        try {
                            callback(data);
                        } catch (e) {
                            console.error(`Error in event handler for ${event}:`, e);
                        }
                    });
                }
            };

            // ============================================================
            // STORAGE SERVICE
            // ============================================================

            const StorageService = {
                /**
                 * Get chat history
                 */
                getHistory() {
                    try {
                        return JSON.parse(localStorage.getItem('tyaza_history') || '[]');
                    } catch {
                        return [];
                    }
                },

                /**
                 * Save chat to history
                 */
                saveToHistory(chat) {
                    const history = this.getHistory();
                    
                    // Filter out invalid entries
                    const validHistory = history.filter(h => 
                        h && h.title && h.title.length > 0 && h.title.length < 50
                    );
                    
                    const existingIndex = validHistory.findIndex(c => c.id === chat.id);
                    
                    if (existingIndex >= 0) {
                        validHistory[existingIndex] = chat;
                    } else {
                        validHistory.unshift(chat);
                    }
                    
                    // Keep only last 20 chats
                    const trimmed = validHistory.slice(0, 20);
                    localStorage.setItem('tyaza_history', JSON.stringify(trimmed));
                    return trimmed;
                },

                /**
                 * Clear all history
                 */
                clearHistory() {
                    localStorage.removeItem('tyaza_history');
                }
            };

            // ============================================================
            // TOAST NOTIFICATION SYSTEM
            // ============================================================

            const ToastService = {
                container: null,

                /**
                 * Initialize toast container
                 */
                init() {
                    this.container = document.getElementById('toastContainer');
                },

                /**
                 * Show toast notification
                 */
                show(message, type = 'info', duration = 3000) {
                    if (!this.container) this.init();

                    const toast = document.createElement('div');
                    toast.className = `toast toast-${type}`;
                    toast.innerHTML = `
                        <i class="fas fa-${this.getIcon(type)}"></i>
                        <span>${escapeHtml(message)}</span>
                    `;

                    this.container.appendChild(toast);

                    setTimeout(() => {
                        toast.style.opacity = '0';
                        toast.style.transform = 'translateX(100%)';
                        setTimeout(() => toast.remove(), 300);
                    }, duration);
                },

                /**
                 * Get icon for toast type
                 */
                getIcon(type) {
                    const icons = {
                        success: 'check-circle',
                        error: 'exclamation-circle',
                        warning: 'exclamation-triangle',
                        info: 'info-circle'
                    };
                    return icons[type] || 'info-circle';
                },

                success(message) { this.show(message, 'success'); },
                error(message) { this.show(message, 'error'); },
                warning(message) { this.show(message, 'warning'); },
                info(message) { this.show(message, 'info'); }
            };

            // ============================================================
            // SPEECH SERVICES
            // ============================================================

            const SpeechService = {
                /**
                 * Initialize speech recognition
                 */
                initRecognition() {
                    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
                        return false;
                    }

                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    const recognition = new SpeechRecognition();
                    
                    recognition.continuous = false;
                    recognition.interimResults = true;
                    recognition.lang = 'rw-RW';

                    recognition.onstart = () => {
                        EventBus.emit('recognition:start');
                    };

                    recognition.onend = () => {
                        EventBus.emit('recognition:end');
                    };

                    recognition.onresult = (event) => {
                        let transcript = '';
                        for (let i = 0; i < event.results.length; i++) {
                            transcript += event.results[i][0].transcript;
                        }
                        EventBus.emit('recognition:result', transcript);
                    };

                    recognition.onerror = (event) => {
                        EventBus.emit('recognition:error', event.error);
                    };

                    StateManager.set('speechRecognition', recognition);
                    return true;
                },

                /**
                 * Start speech recognition
                 */
                startRecognition() {
                    const recognition = StateManager.get('speechRecognition');
                    if (recognition) {
                        try {
                            recognition.start();
                        } catch (e) {
                            console.error('Recognition start error:', e);
                        }
                    }
                },

                /**
                 * Stop speech recognition
                 */
                stopRecognition() {
                    const recognition = StateManager.get('speechRecognition');
                    if (recognition) {
                        try {
                            recognition.stop();
                        } catch (e) {
                            console.error('Recognition stop error:', e);
                        }
                    }
                },

                /**
                 * Initialize speech synthesis
                 */
                initSynthesis() {
                    const synth = StateManager.get('speechSynthesis');
                    if (synth) {
                        const loadVoices = () => {
                            StateManager.set('availableVoices', synth.getVoices());
                        };
                        
                        loadVoices();
                        synth.onvoiceschanged = loadVoices;
                    }
                },

                /**
                 * Speak text
                 */
                speak(text) {
                    const synth = StateManager.get('speechSynthesis');
                    const settings = StateManager.get('settings');
                    
                    if (!synth || !settings.autoTTS) return;
                    
                    // Cancel any ongoing speech
                    synth.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(text.substring(0, 1000));
                    
                    // Set voice
                    if (StateManager.get('availableVoices').length > 0) {
                        const voiceName = settings.voice;
                        const voice = StateManager.get('availableVoices').find(v => 
                            v.name.includes(voiceName.split(' ')[0])
                        ) || StateManager.get('availableVoices')[0];
                        
                        if (voice) utterance.voice = voice;
                    }
                    
                    // Set rate and pitch
                    utterance.rate = parseFloat(settings.rate);
                    utterance.pitch = parseFloat(settings.pitch);
                    
                    // Language
                    utterance.lang = 'rw-RW';
                    
                    synth.speak(utterance);
                }
            };

            // ============================================================
            // AI SERVICE
            // ============================================================

            const AIService = {
                /**
                 * System context for Tyaza
                 */
                systemContext: `Wowe uri Tyaza, umuvugizi w'umutima wahimbwe na Kivura Labs.

KIVURA LABS:
- Kivura Labs ni isosiyete ikora ubushakashatsi mu by'ubwenge bw'ikoranabuhanga (AI) ifite icyicaro i Rwanda
- Ikora ibijyanye na Mental Health, Voice Technology, na Local Language Computing
- Intego yayo: gufasha abantu babana n'ibibazo by'umutekano mu mutwe binyuze mu ikoranabuhanga

CEO: Yves Hirwa Tuyishime
- Yavutse ku ya 1 Kamena 2005 i Kagarama, Kicukiro, Kigali
- Niwe washinze Kivura Labs akaba na CEO
- Yitoje ubwenge bw'ikoranabuhanga (AI) ku giti cye

TYAZA:
- Uri AI virtual therapy assistant
- Uvuga Kinyarwanda neza, kandi ushobora no kumva no kwishyura mu ndimi zindi
- Ufasha abantu mu by'umutekano mu mutwe, ubibutsa, ugatera inkunga
- Ntabwo usimbura umuvuzi w'umubiri, ariko uri umuvugizi w'umutima ufasha

UKO WITWARA:
- Shyashya mu ijwi ryuje impuhwe, ubumuntu n'ubugoro
- Komeza ibiganiro bigufi kandi byuje ubushyuhe
- Ibaza, umve, ugire inama
- Wibuke ko buri wese yakira impuhwe
- Koresha amagambo nk' "umva", "umutima", "mahoro", "impuhwe" kenshi
- Ntugire ubusobanuro burebure cyane, ariko ugaragaze ko umva

Intego yawe: Kugira ngo nta wusigara inyuma mu bijyanye n'ikoranabuhanga â haba mu rurimi, haba mu mibereho.`,

                /**
                 * Check if Puter is ready
                 */
                async checkConnection() {
                    return new Promise((resolve) => {
                        let attempts = 0;
                        const maxAttempts = 25;
                        const interval = setInterval(() => {
                            attempts++;
                            
                            if (window.puter && window.puter.ai) {
                                clearInterval(interval);
                                resolve(true);
                            } else if (attempts >= maxAttempts) {
                                clearInterval(interval);
                                resolve(false);
                            }
                        }, 200);
                    });
                },

                /**
                 * Send message to AI
                 */
                async sendMessage(messages) {
                    const isReady = await this.checkConnection();
                    StateManager.set('puterReady', isReady);
                    
                    if (isReady && window.puter?.ai) {
                        try {
                            const model = StateManager.get('settings.model');
                            const response = await window.puter.ai.chat([
                                { role: 'system', content: this.systemContext },
                                ...messages.slice(-10)
                            ], {
                                model: model,
                                stream: true
                            });

                            let fullResponse = '';
                            for await (const part of response) {
                                fullResponse += part.text || part.message?.content || '';
                                EventBus.emit('ai:stream', fullResponse);
                            }
                            
                            return fullResponse;
                        } catch (error) {
                            console.error('AI Error:', error);
                            return this.getFallbackResponse(messages[messages.length - 1]?.content || '');
                        }
                    } else {
                        return this.getFallbackResponse(messages[messages.length - 1]?.content || '');
                    }
                },

                /**
                 * Get fallback response
                 */
                getFallbackResponse(userMessage) {
                    const responses = [
                        "Ndumva. Urakoze kunsangiza ibi. Nzavyumvira.",
                        "Ibyo ubwishaka byakomeye. Uri kumwe nawe.",
                        "Ndi kumwe nawe. Wumva ute ubu?",
                        "Urakoze kundekera. Ibyo birashishikara.",
                        "Ndakumva. Buri jambo rifite agaciro.",
                        "Mfite icyo mbashishaka. Nzavyikanyeye.",
                        "Ndi hano. Ngomba gutegereza kimwe cya munsi.",
                        "Umva neza. Ibyo ub Rwanda birakomeye.",
                        "Uri kumwe nawe muri iri jambo. Tujyane hamwe.",
                        "Ndagira nk'umuvugizi w'umutima. Ngira icyo mbajije."
                    ];
                    
                    // Try to match context from user message
                    const lowerMessage = userMessage.toLowerCase();
                    
                    if (lowerMessage.includes('mfite') || lowerMessage.includes('ibibazo')) {
                        return "Ndumva ko ufite ibibazo. Ndi hano kugira ngo nguteze. Ubwo utubwire ikibazo cyawe, tukanakoresheje iri jambo rikwege.";
                    }
                    
                    if (lowerMessage.includes('ngomba') || lowerMessage.includes('inkunga')) {
                        return "Nagira inkunga. Ndi hano kugira ngo nkugire. Tuganire kugira ngo nibonde.";
                    }
                    
                    if (lowerMessage.includes('maraye') || lowerMessage.includes('impuhwe')) {
                        return "Ndagira impuhwe. Ariko nibagiwe ko buri munsi hari igihe. Ngaho, tuganire kugira ngo nibonde.";
                    }
                    
                    return responses[Math.floor(Math.random() * responses.length)];
                }
            };

            // ============================================================
            // UI COMPONENTS
            // ============================================================

            const UI = {
                elements: {},

                /**
                 * Cache DOM elements
                 */
                cacheElements() {
                    this.elements = {
                        // Layout
                        app: document.getElementById('app'),
                        sidebar: document.getElementById('sidebar'),
                        sidebarOverlay: document.getElementById('sidebarOverlay'),
                        menuToggle: document.getElementById('menuToggle'),
                        
                        // Chat
                        messagesWrapper: document.getElementById('messagesWrapper'),
                        welcomeScreen: document.getElementById('welcomeScreen'),
                        messageInput: document.getElementById('messageInput'),
                        sendBtn: document.getElementById('sendBtn'),
                        scrollBottom: document.getElementById('scrollBottom'),
                        
                        // Voice
                        voiceInputBtn: document.getElementById('voiceInputBtn'),
                        voiceStatus: document.getElementById('voiceStatus'),
                        sttOverlay: document.getElementById('sttOverlay'),
                        sttText: document.getElementById('sttText'),
                        micTestBtn: document.getElementById('micTestBtn'),
                        previewBtn: document.getElementById('previewBtn'),
                        
                        // Settings
                        modelSelect: document.getElementById('modelSelect'),
                        voiceSelect: document.getElementById('voiceSelect'),
                        rateSlider: document.getElementById('rateSlider'),
                        pitchSlider: document.getElementById('pitchSlider'),
                        rateValue: document.getElementById('rateValue'),
                        pitchValue: document.getElementById('pitchValue'),
                        autoTTS: document.getElementById('autoTTS'),
                        soundEffects: document.getElementById('soundEffects'),
                        animations: document.getElementById('animations'),
                        
                        // History
                        historyList: document.getElementById('historyList'),
                        clearHistory: document.getElementById('clearHistory'),
                        newChatBtn: document.getElementById('newChatBtn'),
                        
                        // Header actions
                        exportChat: document.getElementById('exportChat'),
                        clearChat: document.getElementById('clearChat'),
                        settingsBtn: document.getElementById('settingsBtn'),
                        
                        // Loading
                        loadingScreen: document.getElementById('loadingScreen'),
                        
                        // Stars
                        starsContainer: document.getElementById('starsContainer')
                    };
                },

                /**
                 * Create stars background
                 */
                createStars() {
                    const container = this.elements.starsContainer;
                    const starCount = 80;
                    
                    for (let i = 0; i < starCount; i++) {
                        const star = document.createElement('div');
                        const size = Math.random() > 0.8 ? 'large' : (Math.random() > 0.5 ? 'medium' : 'small');
                        star.className = `star ${size}`;
                        star.style.left = `${Math.random() * 100}%`;
                        star.style.top = `${Math.random() * 100}%`;
                        star.style.animationDelay = `${Math.random() * 3}s`;
                        star.style.opacity = Math.random() * 0.6 + 0.2;
                        container.appendChild(star);
                    }
                },

                /**
                 * Toggle sidebar
                 */
                toggleSidebar() {
                    const isOpen = StateManager.get('isSidebarOpen');
                    
                    this.elements.sidebar.classList.toggle('open', !isOpen);
                    this.elements.sidebarOverlay.classList.toggle('active', !isOpen);
                    
                    StateManager.set('isSidebarOpen', !isOpen);
                },

                /**
                 * Close sidebar
                 */
                closeSidebar() {
                    this.elements.sidebar.classList.remove('open');
                    this.elements.sidebarOverlay.classList.remove('active');
                    StateManager.set('isSidebarOpen', false);
                },

                /**
                 * Add message to chat
                 */
                addMessage(role, content, streaming = false) {
                    // Hide welcome screen if visible
                    if (this.elements.welcomeScreen && 
                        this.elements.welcomeScreen.style.display !== 'none') {
                        this.elements.welcomeScreen.style.display = 'none';
                    }

                    const messageId = generateId();
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message ${role}`;
                    messageDiv.id = messageDiv.id || `msg-${messageId}`;
                    
                    const time = formatMessageTime();
                    
                    messageDiv.innerHTML = `
                        <div class="message-avatar">${role === 'user' ? 'ð¤' : 'T'}</div>
                        <div class="message-content">
                            <div class="message-bubble" id="bubble-${messageId}">
                                ${formatMessageContent(content)}
                            </div>
                            <div class="message-meta">
                                <span class="message-time">${time}</span>
                                <div class="message-actions">
                                    ${role === 'assistant' ? `
                                        <button class="message-action tooltip" data-toholeho:Soma" 
                                            onclick="UI.speakMessage('${escapeHtml(content).replace(/'/g, "\\'")}')">
                                            <i class="fas fa-volume-up"></i>
                                        </button>
                                        <button class="message-action tooltip" data-toholeho:Kopera" 
                                            onclick="UI.copyMessage('${escapeHtml(content).replace(/'/g, "\\'")}')">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;

                    this.elements.messagesWrapper.appendChild(messageDiv);
                    this.scrollToBottom();
                    
                    return messageId;
                },

                /**
                 * Update message content (for streaming)
                 */
                updateMessage(messageId, content) {
                    const bubble = document.getElementById(`bubble-${messageId}`);
                    if (bubble) {
                        bubble.innerHTML = formatMessageContent(content) + ' <span style="animation: blink 1s infinite;">â</span>';
                    }
                },

                /**
                 * Finish message streaming
                 */
                finishMessage(messageId, content) {
                    const bubble = document.getElementById(`bubble-${messageId}`);
                    if (bubble) {
                        bubble.innerHTML = formatMessageContent(content);
                    }
                },

                /**
                 * Show typing indicator
                 */
                showTypingIndicator() {
                    const id = 'typing-' + generateId();
                    const typingDiv = document.createElement('div');
                    typingDiv.className = 'typing-indicator';
                    typingDiv.id = id;
                    typingDiv.innerHTML = `
                        <div class="typing-avatar">T</div>
                        <div class="typing-bubble">
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                        </div>
                    `;
                    
                    this.elements.messagesWrapper.appendChild(typingDiv);
                    this.scrollToBottom();
                    
                    return id;
                },

                /**
                 * Remove typing indicator
                 */
                removeTypingIndicator(id) {
                    const el = document.getElementById(id);
                    if (el) el.remove();
                },

                /**
                 * Render chat history
                 */
                renderHistory() {
                    let history = StorageService.getHistory();
                    
                    // Filter out invalid/empty entries
                    history = history.filter(chat => 
                        chat && 
                        chat.title && 
                        chat.title.length > 0 &&
                        chat.title.length < 50 &&
                        !chat.title.includes('ð¢') &&
                        !chat.title.includes('KIVURA') &&
                        !chat.title.includes('Intego')
                    );
                    
                    if (history.length === 0) {
                        this.elements.historyList.innerHTML = `
                            <div class="history-empty">
                                <i>ð­</i>
                                <span>Nta mateka</span>
                            </div>
                        `;
                        return;
                    }

                    this.elements.historyList.innerHTML = history.map(chat => `
                        <div class="history-item ${chat.id === StateManager.get('currentChatId') ? 'active' : ''}" 
                             data-id="${chat.id}">
                            <div class="history-title">${escapeHtml(chat.title)}</div>
                            <div class="history-meta">
                                <span>${formatRelativeTime(chat.timestamp)}</span>
                            </div>
                        </div>
                    `).join('');

                    // Add click handlers
                    this.elements.historyList.querySelectorAll('.history-item').forEach(item => {
                        item.addEventListener('click', () => {
                            const id = item.dataset.id;
                            App.restoreChat(id);
                        });
                    });
                },

                /**
                 * Start new chat
                 */
                startNewChat() {
                    StateManager.set('currentChat', []);
                    StateManager.set('currentChatId', generateId());
                    StateManager.set('chatStarted', false);
                    
                    // Clear messages
                    const messages = this.elements.messagesWrapper.querySelectorAll('.message, .typing-indicator');
                    messages.forEach(msg => msg.remove());
                    
                    // Show welcome screen
                    this.elements.welcomeScreen.style.display = 'flex';
                    
                    // Clear input
                    this.elements.messageInput.value = '';
                    this.elements.sendBtn.disabled = true;
                    
                    this.renderHistory();
                    this.closeSidebar();
                },

                /**
                 * Scroll to bottom
                 */
                scrollToBottom() {
                    this.elements.messagesWrapper.scrollTo({
                        top: this.elements.messagesWrapper.scrollHeight,
                        behavior: 'smooth'
                    });
                },

                /**
                 * Handle scroll
                 */
                handleScroll() {
                    const { scrollTop, scrollHeight, clientHeight } = this.elements.messagesWrapper;
                    const atBottom = scrollHeight - scrollTop - clientHeight < 150;
                    
                    this.elements.scrollBottom.classList.toggle('visible', !atBottom);
                },

                /**
                 * Speak message
                 */
                speakMessage(content) {
                    const settings = StateManager.get('settings');
                    
                    // Check if TTS is enabled in settings
                    if (!settings.autoTTS) {
                        ToastService.info('Fungura TTS mububiko ibiro - Soma igisubizo mu ijwi');
                        return;
                    }
                    
                    SpeechService.speak(content.replace(/<[^>]*>/g, ''));
                },

                /**
                 * Copy message to clipboard
                 */
                copyMessage(content) {
                    navigator.clipboard.writeText(content).then(() => {
                        ToastService.success('Ibyakiriwe!');
                    }).catch(() => {
                        ToastService.error('Ntabashije kubika!');
                    });
                },

                /**
                 * Update input height
                 */
                updateInputHeight() {
                    const input = this.elements.messageInput;
                    input.style.height = 'auto';
                    input.style.height = Math.min(input.scrollHeight, 150) + 'px';
                },

                /**
                 * Set loading state
                 */
                setLoading(loading) {
                    this.elements.loadingScreen.classList.toggle('hidden', !loading);
                }
            };

            // Make UI globally accessible
            window.UI = UI;

            // ============================================================
            // APPLICATION
            // ============================================================

            const App = {
                /**
                 * Initialize application
                 */
                async init() {
                    // Load settings
                    StateManager.loadSettings();
                    
                    // Cache elements
                    UI.cacheElements();
                    
                    // Create visual effects
                    UI.createStars();
                    
                    // Initialize speech services
                    SpeechService.initRecognition();
                    SpeechService.initSynthesis();
                    
                    // Bind events
                    this.bindEvents();
                    
                    // Render history
                    UI.renderHistory();
                    
                    // Apply settings to UI
                    this.applySettings();
                    
                    // Check Puter connection
                    this.checkPuterConnection();
                    
                    // Hide loading screen
                    setTimeout(() => {
                        UI.setLoading(false);
                    }, 2000);
                    
                    console.log('TYAZA initialized successfully');
                },

                /**
                 * Bind event listeners
                 */
                bindEvents() {
                    // Sidebar
                    UI.elements.menuToggle?.addEventListener('click', () => UI.toggleSidebar());
                    UI.elements.sidebarOverlay?.addEventListener('click', () => UI.closeSidebar());
                    UI.elements.newChatBtn?.addEventListener('click', () => App.startNewChat());
                    
                    // Message input
                    UI.elements.messageInput?.addEventListener('input', () => this.handleInputChange());
                    UI.elements.messageInput?.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            if (!UI.elements.sendBtn.disabled) {
                                this.sendMessage();
                            }
                        }
                    });
                    UI.elements.sendBtn?.addEventListener('click', () => this.sendMessage());
                    
                    // Voice
                    UI.elements.voiceInputBtn?.addEventListener('click', () => this.toggleVoiceInput());
                    UI.elements.micTestBtn?.addEventListener('click', () => this.testMicrophone());
                    UI.elements.previewBtn?.addEventListener('click', () => this.previewVoice());
                    
                    // Settings
                    UI.elements.modelSelect?.addEventListener('change', (e) => {
                        StateManager.set('settings.model', e.target.value);
                        StateManager.saveSettings();
                    });
                    
                    UI.elements.voiceSelect?.addEventListener('change', (e) => {
                        StateManager.set('settings.voice', e.target.value);
                        StateManager.saveSettings();
                    });
                    
                    UI.elements.rateSlider?.addEventListener('input', (e) => {
                        UI.elements.rateValue.textContent = e.target.value;
                        StateManager.set('settings.rate', e.target.value);
                    });
                    
                    UI.elements.rateSlider?.addEventListener('change', () => StateManager.saveSettings());
                    
                    UI.elements.pitchSlider?.addEventListener('input', (e) => {
                        UI.elements.pitchValue.textContent = e.target.value;
                        StateManager.set('settings.pitch', e.target.value);
                    });
                    
                    UI.elements.pitchSlider?.addEventListener('change', () => StateManager.saveSettings());
                    
                    UI.elements.autoTTS?.addEventListener('change', (e) => {
                        StateManager.set('settings.autoTTS', e.target.checked);
                        StateManager.saveSettings();
                    });
                    
                    UI.elements.soundEffects?.addEventListener('change', (e) => {
                        StateManager.set('settings.soundEffects', e.target.checked);
                        StateManager.saveSettings();
                    });
                    
                    UI.elements.animations?.addEventListener('change', (e) => {
                        StateManager.set('settings.animations', e.target.checked);
                        StateManager.saveSettings();
                    });
                    
                    // History
                    UI.elements.clearHistory?.addEventListener('click', () => this.clearAllHistory());
                    
                    // Scroll
                    UI.elements.messagesWrapper?.addEventListener('scroll', () => UI.handleScroll());
                    UI.elements.scrollBottom?.addEventListener('click', () => UI.scrollToBottom());
                    
                    // Header actions
                    UI.elements.exportChat?.addEventListener('click', () => this.exportChat());
                    UI.elements.clearChat?.addEventListener('click', () => this.clearCurrentChat());
                    
                    // Suggestions
                    document.querySelectorAll('.suggestion-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            UI.elements.messageInput.value = btn.dataset.prompt;
                            this.handleInputChange();
                            UI.elements.messageInput.focus();
                        });
                    });

                    // Event: Recognition
                    EventBus.on('recognition:start', () => {
                        StateManager.set('isListening', true);
                        UI.elements.voiceInputBtn.classList.add('listening');
                        UI.elements.sttOverlay.classList.add('active');
                        UI.elements.sttText.textContent = 'ndakumva...';
                    });

                    EventBus.on('recognition:end', () => {
                        StateManager.set('isListening', false);
                        UI.elements.voiceInputBtn.classList.remove('listening');
                        UI.elements.sttOverlay.classList.remove('active');
                        
                        if (UI.elements.messageInput.value.trim()) {
                            this.sendMessage();
                        }
                    });

                    EventBus.on('recognition:result', (transcript) => {
                        UI.elements.messageInput.value = transcript;
                        UI.elements.sttText.textContent = transcript || 'ndakumva...';
                        UI.elements.sendBtn.disabled = !transcript.trim() || StateManager.get('isGenerating');
                    });

                    EventBus.on('recognition:error', (error) => {
                        UI.elements.voiceStatus.textContent = `Ikosa: ${error}`;
                        UI.elements.voiceStatus.classList.add('active');
                    });
                },

                /**
                 * Apply settings to UI elements
                 */
                applySettings() {
                    const settings = StateManager.get('settings');
                    
                    if (UI.elements.modelSelect) {
                        UI.elements.modelSelect.value = settings.model;
                    }
                    
                    if (UI.elements.voiceSelect) {
                        UI.elements.voiceSelect.value = settings.voice;
                    }
                    
                    if (UI.elements.rateSlider) {
                        UI.elements.rateSlider.value = settings.rate;
                        UI.elements.rateValue.textContent = settings.rate;
                    }
                    
                    if (UI.elements.pitchSlider) {
                        UI.elements.pitchSlider.value = settings.pitch;
                        UI.elements.pitchValue.textContent = settings.pitch;
                    }
                    
                    if (UI.elements.autoTTS) {
                        UI.elements.autoTTS.checked = settings.autoTTS;
                    }
                    
                    if (UI.elements.soundEffects) {
                        UI.elements.soundEffects.checked = settings.soundEffects;
                    }
                    
                    if (UI.elements.animations) {
                        UI.elements.animations.checked = settings.animations;
                    }
                },

                /**
                 * Handle input change
                 */
                handleInputChange() {
                    const value = UI.elements.messageInput.value.trim();
                    UI.elements.sendBtn.disabled = !value || StateManager.get('isGenerating');
                    UI.updateInputHeight();
                },

                /**
                 * Toggle voice input
                 */
                async toggleVoiceInput() {
                    if (!StateManager.get('micPermission')) {
                        await this.testMicrophone();
                        if (!StateManager.get('micPermission')) return;
                    }

                    if (StateManager.get('isListening')) {
                        SpeechService.stopRecognition();
                    } else {
                        SpeechService.startRecognition();
                    }
                },

                /**
                 * Test microphone
                 */
                async testMicrophone() {
                    UI.elements.micTestBtn.innerHTML = '<span class="spinner spinner-sm"></span> ndategura...';
                    
                    try {
                        await navigator.mediaDevices.getUserMedia({ audio: true });
                        StateManager.set('micPermission', true);
                        
                        UI.elements.micTestBtn.innerHTML = 'â yiteguye';
                        UI.elements.voiceStatus.textContent = 'â Mikorofoni yiteguye';
                        UI.elements.voiceStatus.classList.add('active');
                        
                        // Initialize recognition if not already
                        if (!StateManager.get('speechRecognition')) {
                            SpeechService.initRecognition();
                        }
                    } catch (error) {
                        UI.elements.micTestBtn.innerHTML = 'â emerera';
                        UI.elements.voiceStatus.textContent = 'â Emera mikorofoni';
                        StateManager.set('micPermission', false);
                    }

                    setTimeout(() => {
                        UI.elements.micTestBtn.innerHTML = '<span>ð¤</span> Genzura Mikorofoni';
                        setTimeout(() => {
                            UI.elements.voiceStatus.classList.remove('active');
                        }, 2000);
                    }, 2000);
                },

                /**
                 * Preview voice
                 */
                previewVoice() {
                    SpeechService.speak("Ndi kumwe nawe. Wumva ute ubu?");
                },

                /**
                 * Send message
                 */
                async sendMessage() {
                    const text = UI.elements.messageInput.value.trim();
                    if (!text || StateManager.get('isGenerating')) return;

                    // Hide welcome screen
                    if (!StateManager.get('chatStarted')) {
                        StateManager.set('chatStarted', true);
                    }

                    // Add user message
                    UI.addMessage('user', text);
                    StateManager.get('currentChat').push({ role: 'user', content: text });

                    // Clear input
                    UI.elements.messageInput.value = '';
                    UI.elements.sendBtn.disabled = true;
                    UI.updateInputHeight();

                    // Show typing indicator
                    const typingId = UI.showTypingIndicator();
                    StateManager.set('isGenerating', true);

                    try {
                        // Get AI response
                        const reply = await AIService.sendMessage(StateManager.get('currentChat'));
                        
                        // Remove typing and add response
                        UI.removeTypingIndicator(typingId);
                        UI.addMessage('assistant', reply);
                        StateManager.get('currentChat').push({ role: 'assistant', content: reply });

                        // Save to history
                        this.saveToHistory(text);

                    // Speak response if enabled - USER MUST CLICK TO LISTEN
                    // Auto-speak is disabled by default for privacy
                    // User clicks the speaker button on the message to listen
                    } catch (error) {
                        console.error('Send message error:', error);
                        UI.removeTypingIndicator(typingId);
                        UI.addMessage('assistant', 'Ndi kumwe nawe. Hari ikibazo, ngaho tuganire.');
                    } finally {
                        StateManager.set('isGenerating', false);
                    }
                },

                /**
                 * Save chat to history
                 */
                saveToHistory(firstMessage) {
                    const chat = {
                        id: StateManager.get('currentChatId'),
                        title: firstMessage.slice(0, 40),
                        messages: StateManager.get('currentChat').slice(-15),
                        timestamp: Date.now()
                    };
                    
                    StorageService.saveToHistory(chat);
                    UI.renderHistory();
                },

                /**
                 * Restore chat
                 */
                restoreChat(id) {
                    const history = StorageService.getHistory();
                    const chat = history.find(c => c.id === id);
                    
                    if (!chat) return;
                    
                    StateManager.set('currentChatId', chat.id);
                    StateManager.set('currentChat', chat.messages);
                    StateManager.set('chatStarted', true);
                    
                    // Clear messages
                    const messages = UI.elements.messagesWrapper.querySelectorAll('.message, .typing-indicator');
                    messages.forEach(msg => msg.remove());
                    
                    // Add messages
                    chat.messages.forEach(msg => {
                        UI.addMessage(msg.role, msg.content);
                    });
                    
                    UI.renderHistory();
                    UI.closeSidebar();
                },

                /**
                 * Start new chat
                 */
                startNewChat() {
                    StateManager.set('currentChat', []);
                    StateManager.set('currentChatId', generateId());
                    StateManager.set('chatStarted', false);
                    
                    // Clear messages
                    const messages = UI.elements.messagesWrapper.querySelectorAll('.message, .typing-indicator');
                    messages.forEach(msg => msg.remove());
                    
                    // Show welcome
                    UI.elements.welcomeScreen.style.display = 'flex';
                    
                    // Clear input
                    UI.elements.messageInput.value = '';
                    UI.elements.sendBtn.disabled = true;
                    
                    UI.renderHistory();
                },

                /**
                 * Clear all history
                 */
                clearAllHistory() {
                    if (confirm('Hanagura amateka yose?')) {
                        StorageService.clearHistory();
                        this.startNewChat();
                        ToastService.success('Amateka yahanaguwe');
                    }
                },

                /**
                 * Export chat
                 */
                exportChat() {
                    const chat = StateManager.get('currentChat');
                    
                    if (chat.length === 0) {
                        ToastService.warning('Nta chatææ± kwerekana');
                        return;
                    }
                    
                    let text = "TYAZA - Igikoni\n";
                    text += "â".repeat(40) + "\n\n";
                    
                    chat.forEach(msg => {
                        text += (msg.role === 'user' ? 'ð¤ User' : 'ð¤ TYAZA') + "\n";
                        text += "â".repeat(20) + "\n";
                        text += msg.content + "\n\n";
                    });
                    
                    const blob = new Blob([text], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `tyaza-${Date.now()}.txt`;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    ToastService.success('Fashwe neza!');
                },

                /**
                 * Clear current chat
                 */
                clearCurrentChat() {
                    if (StateManager.get('currentChat').length === 0) return;
                    
                    if (confirm('Hanagura chat hiye?')) {
                        this.startNewChat();
                        ToastService.success('Chat yahanaguwe');
                    }
                },

                /**
                 * Check Puter connection
                 */
                async checkPuterConnection() {
                    const isReady = await AIService.checkConnection();
                    StateManager.set('puterReady', isReady);
                    
                    if (!isReady) {
                        UI.elements.voiceStatus.textContent = 'â Kanda ku kimenyetso cya Puter wandikishe';
                        UI.elements.voiceStatus.classList.add('active');
                    }
                }
            };

            // ============================================================
            // INITIALIZATION
            // ============================================================

            // Start app when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => App.init());
            } else {
                App.init();
            }

            // Add keyboard shortcut
            document.addEventListener('keydown', (e) => {
                // Cmd/Ctrl + K to focus input
                if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                    e.preventDefault();
                    UI.elements.messageInput.focus();
                }
                
                // Cmd/Ctrl + N for new chat
                if ((e.metaKey || e.ctrlKey) && e.key === 'n') {
                    e.preventDefault();
                    App.startNewChat();
                }
                
                // Escape to close sidebar
                if (e.key === 'Escape') {
                    if (StateManager.get('isSidebarOpen')) {
                        UI.closeSidebar();
                    }
                }
            });

        })();
    </script>
</body>
</html>
